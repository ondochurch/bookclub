# Google Spreadsheet 연동 가이드

이 가이드는 북클럽 토론 내용을 Google Spreadsheet에서 자동으로 불러오는 방법을 안내합니다.

## 📋 목차
1. [개요](#개요)
2. [스프레드시트 생성](#스프레드시트-생성)
3. [데이터 구조 설정](#데이터-구조-설정)
4. [공개 설정](#공개-설정)
5. [웹사이트 연동](#웹사이트-연동)
6. [테스트](#테스트)

---

## 개요

이 시스템은 Google Spreadsheet를 데이터베이스처럼 사용하여 북클럽 토론 내용을 관리합니다.

### 장점:
- ✅ **무료** - Google Sheets는 무료로 사용 가능
- ✅ **실시간 업데이트** - 스프레드시트 수정 시 웹사이트에 자동 반영
- ✅ **협업** - 여러 사람이 동시에 편집 가능
- ✅ **쉬운 관리** - 엑셀처럼 익숙한 인터페이스
- ✅ **버전 관리** - Google Sheets의 자동 버전 관리 기능

---

## 스프레드시트 생성

### 1단계: Google Sheets 접속
1. [Google Sheets](https://sheets.google.com) 접속
2. Google 계정으로 로그인
3. **+ 새로 만들기** 또는 **빈 스프레드시트** 클릭

### 2단계: 스프레드시트 이름 설정
- 스프레드시트 이름: **"북클럽 토론 내용"**

---

## 데이터 구조 설정

### 3단계: 헤더 행 만들기

첫 번째 행에 다음 열(컬럼)을 생성하세요:

| A (책ID) | B (섹션) | C (내용) |
|---------|---------|---------|
| cosmos | 주요토론 | 우주의 기원에 대한 과학적 설명과 성경의 창조 이야기를 어떻게 조화롭게 이해할 수 있을지 토론했습니다. |
| cosmos | 인사이트 | 과학과 신앙은 대립하는 것이 아니라 하나님의 창조를 더 깊이 이해하는 두 가지 방법임을 깨달았습니다. |
| cosmos | 질문답변 | Q: 빅뱅 이론과 창조론은 양립할 수 있나요?<br>A: 많은 신학자들이 빅뱅을 하나님의 창조 방법으로 해석합니다. |

### 필드 설명:

#### **책ID (book_id)** - A열
책을 식별하는 고유 ID입니다.
- `cosmos` - 코스모스
- `today-worship` - 오늘이라는 예배
- 새 책 추가 시 영문 소문자와 하이픈(-)으로 ID 생성

#### **섹션 (section)** - B열
토론 내용의 분류입니다.
- `주요토론` 또는 `discussion` - 주요 토론 내용
- `인사이트` 또는 `insights` - 인사이트 및 적용점
- `질문답변` 또는 `qa` - 질문과 답변

#### **내용 (content)** - C열
실제 토론 내용, 인사이트, Q&A 등을 입력합니다.

**✨ 여러 줄 입력 방법:**
- Google Sheets에서 **Alt+Enter** (Windows) 또는 **Cmd+Enter** (Mac)를 눌러 셀 안에서 줄바꿈
- 자동으로 문단(`<p>`)으로 변환됩니다

**📋 리스트 작성:**
리스트 항목은 다음 중 하나로 시작:
- `-` 하이픈 (예: `- 첫 번째 항목`)
- `*` 별표 (예: `* 두 번째 항목`)
- `•` 불릿 (예: `• 세 번째 항목`)
- `1.` 숫자 (예: `1. 네 번째 항목`)

자동으로 `<ul><li>` 태그로 변환됩니다.

**📌 특수 문자 (쉼표, 따옴표) 처리:**
- **쉼표 (,)**: 자유롭게 사용 가능! Google Sheets가 자동으로 필드를 따옴표로 감싸서 처리
- **따옴표 (")**: 사용 가능하지만, 두 개 연속으로 입력하면 하나로 표시됨 ("")
- **예시**: "칼 세이건, 그는 천문학자이자 작가였습니다" ← 쉼표 사용 가능!

**예시:**
```
우주의 기원에 대해 토론했습니다.

주요 논점:
- 빅뱅 이론과 창조론의 조화
- 과학과 신앙의 관계
- 우주의 광대함, 그리고 인간의 존재 의미

칼 세이건은 말했습니다: "우리는 별의 물질로 만들어졌다."

결론적으로 과학과 신앙은 서로 보완적입니다.
```

위와 같이 입력하면 자동으로 문단과 리스트로 깔끔하게 표시됩니다.
쉼표, 따옴표 등 모든 문장 부호를 자유롭게 사용할 수 있습니다!

### 4단계: 샘플 데이터 입력

다음과 같은 형식으로 데이터를 입력하세요:

```
책ID          섹션        내용
cosmos        주요토론    칼 세이건의 과학적 우주관과 기독교 세계관을 비교하며 토론했습니다. 특히 우주의 광대함 앞에서 인간의 존재 의미에 대해 깊이 생각해보았습니다.

cosmos        인사이트    - 하나님의 창조 질서의 경이로움을 재발견
- 과학적 탐구도 하나님을 찾아가는 여정
- 우주의 광대함 속에서도 우리를 사랑하시는 하나님의 섭리

cosmos        질문답변    Q: 우주의 나이가 138억년이라는 과학적 증거와 성경의 창조 기록을 어떻게 조화시킬 수 있나요?
A: 성경의 '날'(yom)은 문자적 24시간이 아닌 긴 기간을 의미할 수도 있습니다. 많은 신학자들이 날-시대 이론(Day-Age Theory)을 통해 이를 설명합니다.

today-worship 주요토론    일상의 평범한 순간들이 어떻게 예배가 될 수 있는지 함께 나누었습니다.

today-worship 인사이트    - 아침에 일어나는 것부터 예배의 시작
- 일상의 모든 순간에서 하나님의 임재를 경험
- 특별한 일이 아니어도 예배할 수 있음

today-worship 질문답변    Q: 바쁜 일상에서 어떻게 예배적인 삶을 살 수 있나요?
A: 모든 순간을 하나님께 드린다는 의식으로 살아가는 것이 시작입니다. 설거지, 출퇴근, 대화 등 모든 것이 예배가 될 수 있습니다.
```

---

## 공개 설정

### 5단계: 스프레드시트 공개하기

#### 방법 1: 링크가 있는 모든 사용자에게 공개 (추천)

1. 스프레드시트 우측 상단의 **공유** 버튼 클릭
2. **일반 액세스** 섹션에서:
   - **제한됨** → **링크가 있는 모든 사용자** 선택
   - 권한: **뷰어** (읽기 전용)
3. **링크 복사** 클릭

#### 방법 2: 웹에 게시 (더 안정적)

1. **파일** → **공유** → **웹에 게시** 클릭
2. **게시** 설정:
   - **전체 문서** 선택
   - **쉼표로 구분된 값(.csv)** 선택
3. **게시** 버튼 클릭
4. 생성된 URL 복사

예시 URL:
```
https://docs.google.com/spreadsheets/d/1ABC123XYZ456/export?format=csv&gid=0
```

### 6단계: Spreadsheet ID 확인

스프레드시트 URL에서 ID를 찾으세요:

```
https://docs.google.com/spreadsheets/d/1ABC123XYZ456/edit#gid=0
                                      ^^^^^^^^^^^^^^
                                      이 부분이 Spreadsheet ID
```

### 7단계: GID 확인 (여러 시트가 있을 경우)

URL 끝의 `gid=0` 부분이 시트 ID입니다.
- 첫 번째 시트: `gid=0`
- 두 번째 시트: `gid=1` (생성한 순서대로)

---

## 웹사이트 연동

### 8단계: `bookclub-data.js` 파일 수정

`docs/bookclub-data.js` 파일을 열고 다음 부분을 수정하세요:

**참고**: 이 시스템은 **PapaParse** 라이브러리를 사용하여 CSV를 파싱합니다. PapaParse는 업계 표준 CSV 파서로, 쉼표, 따옴표, 줄바꿈 등 모든 특수 문자를 완벽하게 처리합니다.

#### 방법 1: CSV URL 직접 입력 (추천)

```javascript
const SPREADSHEET_CONFIG = {
  csvUrl: 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=0',
  sheetId: '',
  gid: '0'
};
```

**YOUR_SHEET_ID**를 실제 스프레드시트 ID로 교체하세요.

#### 방법 2: Sheet ID와 GID 입력

```javascript
const SPREADSHEET_CONFIG = {
  csvUrl: '',
  sheetId: '1ABC123XYZ456', // 여기에 Spreadsheet ID 입력
  gid: '0'                   // 여기에 GID 입력
};
```

### 9단계: Git 커밋 및 푸시

```bash
git add docs/bookclub-data.js
git commit -m "Add Google Spreadsheet integration for book summaries"
git push
```

---

## 테스트

### 10단계: 로컬 웹 서버 실행 (중요!)

**⚠️ 중요**: HTML 파일을 더블클릭해서 열면 CORS 오류가 발생합니다!

반드시 로컬 웹 서버를 실행해야 합니다:

#### Python 사용 (추천):
```bash
cd docs
python3 -m http.server 8000
```

브라우저에서 http://localhost:8000 접속

#### Node.js 사용:
```bash
cd docs
npx http-server -p 8000
```

#### VS Code Live Server 확장:
1. VS Code에서 "Live Server" 확장 설치
2. HTML 파일 우클릭 → "Open with Live Server"

### 11단계: 웹사이트에서 확인

1. 로컬 서버에서 책 페이지 방문:
   - http://localhost:8000/book-cosmos.html
   - http://localhost:8000/book-today-worship.html

2. 페이지가 로드되면 자동으로 스프레드시트에서 데이터를 가져옵니다.

3. **브라우저 콘솔**에서 로그 확인:
   - 크롬: F12 → Console 탭
   - 사파리: 개발자 → JavaScript 콘솔
   - 다음과 같은 메시지가 표시되어야 합니다:
     ```
     📊 데이터 로딩 중: https://docs.google.com/...
     ✅ CSV 데이터 로드 완료
     📋 파싱된 데이터: X 행
     📖 "cosmos" 책 데이터: X 개 섹션
     ```

### 예상되는 동작:

✅ **성공**: placeholder가 사라지고 스프레드시트의 내용이 표시됩니다.

❌ **실패**: placeholder가 그대로 유지됩니다.
- 콘솔에서 오류 메시지 확인
- 스프레드시트 공개 설정 확인
- CSV URL이 올바른지 확인
- 로컬 웹 서버로 실행하고 있는지 확인 (file:// 아님!)

---

## 🔧 문제 해결

### 문제 1: 데이터가 로드되지 않음

**원인**: 스프레드시트가 공개되지 않았거나 URL이 잘못됨

**해결**:
1. 스프레드시트 공개 설정 확인
2. CSV URL 브라우저에서 직접 열어보기
3. 브라우저 콘솔에서 오류 메시지 확인

### 문제 2: CORS 오류 ⚠️ (가장 흔한 문제)

**증상**: 브라우저 콘솔에 다음과 같은 오류:
```
Cross-Origin Resource Sharing policy: Origin null is not allowed
```
또는
```
CORS policy: No 'Access-Control-Allow-Origin' header
```

**원인**:
1. HTML 파일을 더블클릭으로 열었을 때 (`file://` 프로토콜)
2. Google Sheets가 다른 도메인으로 리다이렉트할 때

**해결 방법** (아래 순서대로 시도):

#### ✅ 방법 1: 로컬 웹 서버 실행 (가장 권장)

로컬에서 테스트 시 반드시 웹 서버 사용:

**Python 사용**:
```bash
cd docs
python3 -m http.server 8000
# http://localhost:8000 에서 접속
```

**또는 Node.js 사용**:
```bash
npx http-server docs -p 8000
```

**또는 VS Code Live Server**:
- VS Code에서 Live Server 확장 설치
- HTML 파일 우클릭 → "Open with Live Server"

#### ✅ 방법 2: GitHub Pages에 배포 (프로덕션)

로컬 개발이 아닌 실제 사용 시:
```bash
git add .
git commit -m "Update spreadsheet config"
git push
```

GitHub Pages URL에서 접속:
- `https://ondochurch.github.io/bookclub/book-cosmos.html`

**GitHub Pages에서는 CORS 문제가 발생하지 않습니다!**

#### ✅ 방법 3: 스프레드시트 "웹에 게시" 확인

1. Google Sheets → **파일** → **공유** → **웹에 게시**
2. **전체 문서** 선택
3. **쉼표로 구분된 값(.csv)** 선택
4. **게시** 클릭
5. 생성된 URL 사용

#### ❌ 작동하지 않는 방법:
- HTML 파일 더블클릭 (file:// 프로토콜)
- 로컬 파일 시스템에서 직접 열기
- 웹 서버 없이 브라우저에서 파일 열기

### 문제 3: 데이터가 일부만 표시됨

**원인**: 스프레드시트의 책ID 또는 섹션 이름이 잘못됨

**해결**:
1. 책ID가 정확한지 확인:
   - `cosmos` (코스모스)
   - `today-worship` (오늘이라는 예배)
2. 섹션 이름 확인:
   - `주요토론` 또는 `discussion`
   - `인사이트` 또는 `insights`
   - `질문답변` 또는 `qa`

### 문제 4: 업데이트가 반영되지 않음

**원인**: 브라우저 캐시

**해결**:
- 강력 새로고침: Ctrl+F5 (Windows) 또는 Cmd+Shift+R (Mac)
- 시크릿 모드에서 테스트

### 문제 5: 여러 줄 내용이 잘려 보임

**증상**: 스프레드시트에는 여러 줄이 있는데 웹사이트에는 일부만 표시

**원인**: 셀 내 줄바꿈이 제대로 처리되지 않음

**해결**:

1. **스프레드시트에서 줄바꿈 확인:**
   - 셀을 더블클릭해서 내용 확인
   - Alt+Enter (Windows) 또는 Cmd+Enter (Mac)로 줄바꿈했는지 확인

2. **브라우저 콘솔 확인:**
   - F12 → Console 탭
   - 다음과 같은 로그 확인:
     ```
     📝 섹션: "주요토론", 내용 길이: 245자
     ✅ 주요토론 내용 업데이트 완료
     ```
   - 내용 길이가 예상과 맞는지 확인

3. **CSV 내보내기 확인:**
   - 스프레드시트 CSV URL을 브라우저에서 직접 열기
   - 셀 내용이 따옴표로 감싸져 있는지 확인
   - 예시: `cosmos,"여러 줄\n내용이\n있는 셀",주요토론`

4. **HTML 특수 문자 확인:**
   - `<`, `>`, `&` 같은 문자는 자동으로 이스케이프됩니다
   - 원하는 경우 이런 문자를 그대로 사용 가능

### 문제 6: 쉼표 때문에 내용이 여러 컬럼으로 분리됨

**증상**: 내용에 쉼표가 있을 때 데이터가 잘못 파싱됨

**원인**: Google Sheets의 CSV 내보내기 설정 또는 파싱 오류

**해결**:

1. **브라우저 콘솔 확인** (F12 → Console):
   ```
   📄 CSV 총 4개 행 파싱 완료
   📋 헤더: ["책ID", "섹션", "내용"]
   ⚠️ 2번째 행 컬럼 수 불일치: 예상 3, 실제 5
   ```
   - 컬럼 수 불일치 경고가 있으면 쉼표 처리 문제

2. **Google Sheets에서 확인**:
   - 문제가 되는 셀을 더블클릭
   - 내용에 따옴표가 제대로 있는지 확인
   - Google Sheets는 쉼표가 있는 셀을 자동으로 따옴표로 감싸야 함

3. **CSV 직접 확인**:
   - 스프레드시트 CSV URL을 브라우저에서 열기
   - 올바른 형식:
     ```csv
     책ID,섹션,내용
     cosmos,주요토론,"우주의 기원, 빅뱅 이론, 그리고 창조론"
     ```
   - 잘못된 형식:
     ```csv
     책ID,섹션,내용
     cosmos,주요토론,우주의 기원, 빅뱅 이론, 그리고 창조론
     ```

4. **해결 방법**:
   - Google Sheets → **파일** → **공유** → **웹에 게시**
   - **쉼표로 구분된 값(.csv)** 선택
   - 이 방법이 더 안정적으로 따옴표 처리

5. **최종 확인**:
   - 새로고침 (Ctrl+F5 / Cmd+Shift+R)
   - 콘솔에서 "컬럼 수 불일치" 경고가 사라져야 함

**✅ 수정 완료된 파서**:
이제 따옴표로 감싸진 필드 내의 쉼표는 자동으로 올바르게 처리됩니다!

---

## 💡 사용 팁

### 1. 여러 시트 사용

책별로 시트를 분리하려면:
1. 스프레드시트 하단의 **+ 추가** 클릭
2. 시트 이름: "코스모스", "오늘이라는 예배"
3. 각 시트의 GID를 확인하고 별도의 CSV URL 생성

### 2. 서식 활용

- **굵게**: `<strong>강조할 내용</strong>`
- **줄바꿈**: 셀 내에서 Alt+Enter (Windows) 또는 Cmd+Enter (Mac)
- **리스트**: `-`, `*`, `1.` 로 시작

### 3. 협업 관리

스프레드시트 공유 시:
- **편집 권한**: 신뢰할 수 있는 관리자만
- **댓글 권한**: 팀 멤버
- **뷰어 권한**: 일반 공개

### 4. 버전 관리

Google Sheets의 버전 기록 활용:
1. **파일** → **버전 기록** → **버전 기록 보기**
2. 이전 버전 복원 가능

---

## 📊 스프레드시트 템플릿

복사해서 사용할 수 있는 템플릿:

### 시트 1: 토론 내용

| 책ID | 섹션 | 내용 |
|-----|------|------|
| cosmos | 주요토론 | 내용 입력 |
| cosmos | 인사이트 | 내용 입력 |
| cosmos | 질문답변 | 내용 입력 |
| today-worship | 주요토론 | 내용 입력 |
| today-worship | 인사이트 | 내용 입력 |
| today-worship | 질문답변 | 내용 입력 |

### 새 책 추가 시

1. 책ID 결정 (예: `new-book`)
2. 해당 책의 HTML 파일 생성 또는 복사
3. HTML 파일에서 `window.loadBookClubData('new-book')` 설정
4. 스프레드시트에 데이터 추가

---

## 🎯 다음 단계

1. ✅ Google Spreadsheet 생성
2. ✅ 데이터 구조 설정 (책ID, 섹션, 내용)
3. ✅ 샘플 데이터 입력
4. ✅ 웹에 게시 또는 공개 설정
5. ✅ `bookclub-data.js`에 URL 설정
6. ✅ Git 커밋 및 푸시
7. ✅ 웹사이트에서 테스트
8. 🎉 완료!

---

## 📞 도움이 필요하면?

- [Google Sheets 도움말](https://support.google.com/docs/topic/9054603)
- [GitHub Pages 문서](https://docs.github.com/en/pages)
- 북클럽 관리자에게 문의

---

## 🔐 개인정보 보호

- 스프레드시트 공유 시 **뷰어** 권한만 부여 (편집 불가)
- 민감한 정보는 별도의 비공개 시트에 보관
- 정기적으로 접근 권한 검토
